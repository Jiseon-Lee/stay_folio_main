<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hotel.mapper.StayMapper">

	<!-- 숙소 상세 조회 -->
	<select id="selectStayInfo" resultType="com.hotel.domain.StayVO">
		SELECT *
		FROM t_stay_info
		WHERE si_id = #{si_id}
	</select>

	<select id="selectStayDetail"
		resultType="com.hotel.domain.StayDetailVO">
		SELECT *
		FROM t_stay_info_detail
		WHERE si_id = #{si_id}
	</select>
	<!-- 숙소 상세 조회 끝 -->

	<!-- 숙소에 연결된 객실 목록 조회 -->
	<select id="getRoomsByStayId"
		resultType="com.hotel.domain.RoomVO">
		SELECT
		ri_id, ri_type, ri_name, ri_person, ri_maxperson,
		ri_bedroom, ri_bed, ri_bedcnt, ri_bathroom, ri_price
		FROM t_room_info
		WHERE si_id = #{si_id}
	</select>
	<!-- 숙소에 연결된 객실 목록 조회 끝 -->

	<!-- 숙소 편의시설 목록 -->
	<select id="getFacilitiesByStayId"
		resultType="com.hotel.domain.FacilityVO">
		SELECT f.fi_id, f.fi_name
		FROM t_facility_info f
		JOIN t_stay_facility_rel sfr ON f.fi_id = sfr.fi_id
		WHERE sfr.si_id = #{si_id}
	</select>

	<!-- 객실 편의시설 목록 -->
	<select id="getFacilitiesByRoomId"
		resultType="com.hotel.domain.FacilityVO">
		SELECT f.fi_id, f.fi_name
		FROM t_facility_info f
		JOIN t_room_facility_rel rfr ON f.fi_id = rfr.fi_id
		WHERE rfr.ri_id = #{ri_id}
	</select>


	<!-- admin 숙소 정보 insert 시작 -->
	<!-- 지역 목록 조회 -->
	<select id="getAllLocations"
		resultType="com.hotel.domain.LocationCategoryVO">
		SELECT lc_id, lc_name FROM t_location_category ORDER BY
		lc_id
	</select>

	<!-- 편의시설 목록 조회 -->
	<select id="getAllFacilities"
		resultType="com.hotel.domain.FacilityVO">
		SELECT fi_id, fi_name FROM t_facility_info ORDER BY fi_id
	</select>

	<!-- 숙소 기본 정보 등록 -->
	<insert id="insertStayInfo"
		parameterType="com.hotel.domain.StayVO">
		INSERT INTO t_stay_info (
		si_name, si_desc, si_loca,
		lc_id,
		si_book, si_review, si_minperson, si_maxperson, si_minprice,
		si_extra, si_peak, si_off, si_discount,
		si_show, si_delete, si_date
		)
		VALUES (
		#{si_name}, #{si_desc}, #{si_loca}, #{lc_id},
		#{si_book},
		#{si_review}, #{si_minperson}, #{si_maxperson}, #{si_minprice},
		#{si_extra}, #{si_peak}, #{si_off}, #{si_discount},
		#{si_show},
		#{si_delete}, SYSDATE
		)
	</insert>

	<!-- 가장 최근 si_id -->
	<select id="getLastInsertId" resultType="int">
		SELECT MAX(si_id) FROM
		t_stay_info
	</select>

	<!-- 숙소 상세 설명 등록 -->
	<insert id="insertStayDetail"
		parameterType="com.hotel.domain.StayDetailVO">
		INSERT INTO t_stay_info_detail (
		si_id, si_notice,
		si_desc1, si_desc2, si_feat1, si_feat2,
		si_feat_title1, si_feat_title2,
		si_address, si_addrdesc, si_phone, si_email, si_instagram,
		si_bizname,
		si_biznum, si_ceo,
		si_pet, si_parking, si_food, si_checkin, si_checkout
		) VALUES (
		#{si_id}, #{si_notice, jdbcType=VARCHAR}, #{si_desc1},
		#{si_desc2}, #{si_feat1}, #{si_feat2},
		#{si_feat_title1},
		#{si_feat_title2},
		#{si_address}, #{si_addrdesc}, #{si_phone},
		#{si_email}, #{si_instagram},
		#{si_bizname}, #{si_biznum}, #{si_ceo},
		#{si_pet}, #{si_parking}, #{si_food}, #{si_checkin}, #{si_checkout}
		)
	</insert>


	<!-- 숙소-편의시설 매핑 -->
	<insert id="insertFacilityRel">
		INSERT INTO t_stay_facility_rel (si_id, fi_id)
		VALUES
		(#{si_id}, #{fi_id})
	</insert>
	<!-- admin insert 끝 -->

</mapper>