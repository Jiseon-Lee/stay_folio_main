<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hotel.mapper.CommonMapper">

	<resultMap id="memberMap" type="com.hotel.domain.MemberVO">
		<id column="mi_id" property="miId" />
		<result column="mi_pw" property="miPw" />
		<result column="mi_name" property="miName" />
		<result column="mi_gender" property="miGender" />
		<result column="mi_birth" property="miBirth" />
		<result column="mi_phone" property="miPhone" />
		<result column="mi_isad" property="miIsad" />
		<result column="mi_date" property="miDate" />
		<result column="mi_enabled" property="miEnabled" />
		<collection property="roles" ofType="string">
			<result column="mr_name" />
		</collection>
	</resultMap>

	<select id="read" resultMap="memberMap">
		SELECT 
			mi.mi_id,
			mi.mi_pw,
			mi.mi_name,
			mi.mi_gender,
			mi.mi_birth,
			mi.mi_phone, 
			mi.mi_isad,
			mi.mi_date,
			mi.mi_enabled,
			mr.mr_name 
		FROM t_member_info mi 
		LEFT JOIN t_member_role mr ON mi.mi_id = mr.mi_id 
		WHERE mi.mi_id = #{miId}
	</select>
	
	<select id="countByEmail" resultType="int">
		SELECT count(*) 
		FROM t_member_info 
		WHERE mi_id = #{email}
	</select>
	
	<select id="countByPhone" resultType="int">
		SELECT count(*) 
		FROM t_member_info 
		WHERE mi_phone = #{phone}
	</select>
	
	<insert id="handleRegister">
		INSERT INTO t_member_info (mi_id, mi_pw, mi_name, mi_phone, mi_isad) 
		VALUES (#{miId}, #{miPw}, #{miName}, #{miPhone}, 
			<choose>
      			<when test="miIsad"> '1' </when>
      			<otherwise> '0' </otherwise>
    		</choose>
		)
	</insert>

</mapper>